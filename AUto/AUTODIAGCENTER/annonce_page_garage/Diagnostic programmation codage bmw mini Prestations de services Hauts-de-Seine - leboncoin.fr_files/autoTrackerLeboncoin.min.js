/* SPT */!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AutoTrack=e():t.AutoTrack=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(){var t=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent("_pulse2debug").replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||!1;return t}var o,r={},s=i(1),a=i(2),c={},d=!1;try{c=i(!function(){var t=new Error('Cannot find module "../lib/vars"');throw t.code="MODULE_NOT_FOUND",t}())}catch(u){c=i(18)}n()&&(d=!0),"undefined"!=typeof pulse2opt?r=pulse2opt:"undefined"!=typeof _opt?r=_opt:d&&console.log("init.js: Could not find pulse2opt global variable"),r.debugMode=d;try{o=r.cookieSyncUrl||c.envVars.cookieSyncUrl,a.initTracking(r),o&&s.initCookieSync({url:o,userId:r.userId})}catch(u){d&&console.log("init.js: Pulse2 init failed: "+u)}t.exports=a},function(t,e){"use strict";function i(t){var e=new Image,i=t.url+"?r="+Math.random();t.userId&&(i+="&id="+t.userId),e.src=i}t.exports.initCookieSync=i},function(t,e,i){"use strict";function n(t){var e,n,o,s,a;t=t||{},e=i(3),t.pageLoad!==!1&&e.pageLoad(r),t.hashChange===!0&&e.hashChange(r),t.pageUnload===!0&&e.pageUnload(r),n=i(4),t.clickButton===!0&&n.button(r),t.clickSubmit===!0&&n.submit(r),o=i(5),t.engagement===!0&&o.engagement(r),s=i(6),t.relativeScroll===!0&&s.trackScrollRelative(r,25),t.itemVisible===!0&&s.trackScrollItems(r),a=i(7),t.facebook!==!1&&(a.trackFacebookLikes(r),a.trackFacebookUnlikes(r),a.trackFacebookShares(r),a.trackFacebookElements(r)),t.twitter===!0&&a.trackTwitterShares(r)}function o(t){var e,o=t.throttle||1,s=i(8);return Math.random()<o?(e=i(9),r=new e(t),"complete"===document.readyState?(n(t.trackingFeatures),s.impliedEvents(r)):window.addEventListener("load",function(){n(t.trackingFeatures),s.impliedEvents(r)},!1),r.getPageViewId()):void 0}var r={};t.exports.initTracking=function(t){o(t)},t.exports.getPageViewId=function(){return r.getPageViewId()},t.exports.logoutEvent=function(){r.userLogout()},t.exports.loginEvent=function(t){r.userLogin(t)},t.exports.activity=function(){return r}},function(t,e){"use strict";t.exports.pageLoad=function(t){t.events.trackContentView().send()},t.exports.hashChange=function(t){document.addEventListener("hashchange",function(){t.events.trackContentView().send()},!1)},t.exports.pageUnload=function(t){var e=Date.now(),i=!1;document.addEventListener("click",function(n){var o,r,s,a;i&&(i=!0,o=n.target,"a"===o.tagName.toLowerCase()&&(r=o.getAttribute("href"),s=/^https?:\/\//i,r.match(s)&&(t.events.trackEngagementTime(Date.now()-e).queue(),a=t.events.trackExit("urn:exit:"+r,"Page"),a.addProperty("secondary","url",r),a.queue(),t.sendQueue())))},!1),window.addEventListener("beforeunload",function(){i||(i=!0,t.events.trackEngagementTime(Date.now()-e).queue(),t.events.trackExit().queue(),t.sendQueue())}),window.addEventListener("unload",function(){i||(i=!0,t.events.trackEngagementTime(Date.now()-e).queue(),t.events.trackExit().queue(),t.sendQueue())},!1)}},function(t,e){"use strict";t.exports.button=function(t){document.addEventListener("click",function(e){var i=e.target||e.srcElement;/.*track-click.*/.test(i.className)&&t.events.trackClick(i.id).send()},!1)}},function(t,e){"use strict";t.exports.engagement=function(t){document.addEventListener("click",function(e){var i=e.target||e.srcElement;/.*track-engagement.*/.test(i.className)&&t.events.trackEngagement(t.utils.getViewDuration(),t.utils.getScrollPosition(),"Click",i.tagName,i.id,i.getAttribute("p2-action"),i.getAttribute("p2-meta")).send()},!1)}},function(t,e){"use strict";t.exports.trackScrollRelative=function(t,e){var i=0;document.addEventListener("scroll",function(){var n=document.getElementsByTagName("body")[0],o=n.scrollTop/(n.offsetHeight-window.innerHeight)*100;o-i>1.5*e&&(i=Math.floor(o/e)*e),o>=i+e?(i+=e,t.events.trackScroll(i,"Arrive").send(),i>100&&(i=100)):i-e>=o&&(i-=e,t.events.trackScroll(i,"Arrive").send(),i>100&&(i=100))},!1)},t.exports.trackScrollItems=function(t){function e(t){for(var e=t.offsetTop,i=t.offsetLeft,n=t.offsetWidth,o=t.offsetHeight;t.offsetParent;)t=t.offsetParent,e+=t.offsetTop,i+=t.offsetLeft;return e<window.pageYOffset+window.innerHeight&&i<window.pageXOffset+window.innerWidth&&e+o>window.pageYOffset&&i+n>window.pageXOffset}var i,n,o,r=[],s=document.getElementsByTagName("*");for(o=0;o<s.length;o++)(" "+s[o].className+" ").indexOf(" track-visibility ")>-1&&r.push({element:s[o],visible:!1});document.addEventListener("scroll",function(){for(o=0;o<r.length;o++)i=r[o],e(i.element)!==i.visible&&(i.visible===!1?(i.visible=!0,i.timeStart=t.utils.getTimestamp(),t.events.trackVisibility(i.element.id,i.timeStart).send()):i.visible===!0&&(i.visible=!1,n={start:i.timeStart,end:t.utils.getTimestamp()},t.events.trackVisibility(i.element.id,n).send(),i.timeStart=null))},!1)}},function(t,e){"use strict";t.exports.trackFacebookLikes=function(t){try{FB.Event.subscribe("edge.create",function(e){var i=t.events.trackSocial("facebook-like","Facebook","Like");i.data.target.url=e,i.send()})}catch(e){}},t.exports.trackFacebookUnlikes=function(t){try{FB.Event.subscribe("edge.remove",function(e){var i=t.events.trackSocial("facebook-unlike","Facebook","Remove");i.data.target.url=e,i.send()})}catch(e){}},t.exports.trackFacebookShares=function(t){try{FB.Event.subscribe("message.send",function(e){var i=t.events.trackSocial("facebook-share","Facebook","Share");i.data.target.url=e,i.send()})}catch(e){}},t.exports.trackFacebookElements=function(t){var e,i,n,o=[];try{for(e=document.querySelectorAll('[href*="facebook.com/share"]'),i=0;i<e.length;i++)o.push(e.item(i));for(e=document.querySelectorAll('[data-href*="facebook.com/share"]'),i=0;i<e.length;i++)o.push(e.item(i))}catch(r){}for(n=function(){var e=t.events.trackSocial("facebook-share","Facebook","Share");e.data.object.action="Share button click",e.send()},i=0;i<o.length;i++)o[i].addEventListener("click",n,!1)},t.exports.trackTwitterShares=function(t){function e(){t.events.trackSocial("twitter-share","Twitter","Share").send()}if(twttr)try{twttr.ready(function(){if(!twttr)throw new Error("twitter is not included in the site");twttr.events.bind("tweet",e)})}catch(i){}}},function(t,e){"use strict";t.exports.impliedEvents=function(t){function e(t,e,i){return t[e]?t[e]:i}var i=t.opts.impliedEvents;i&&i.map(function(i){var n;switch(n=i.params,i.track.toLowerCase()){case"create":t.events.trackCreate(e(n,0),e(n,1),e(n,2,{})).send();break;case"login":t.events.trackLogin(e(n,0),e(n,1),e(n,2,{})).send();break;case"logout":t.events.trackLogout(e(n,0),e(n,1),e(n,2,{})).send();break;case"reply":t.events.trackReply(e(n,0),e(n,1),e(n,2,{})).send();break;case"update":t.events.trackUpdate(e(n,0),e(n,1),e(n,2,{})).send()}})}},function(t,e,i){"use strict";function n(t){if(this.pulse2timing={init:Date.now()},!t.optOut){if(this.optOut=!1,this.waitForOptOut=!1,t.waitForOptOut&&(this.optOut="wait",this.waitForOptOut=!0),!t.clientId)throw new Error("clientId is required");this.vars=r,this.version=g,this.clientId=("urn:schibsted.com:"+t.clientId).toLowerCase(),t.url?(this.url=t.url+"/"+this.clientId,this.pixelUrl=t.url):(this.url=this.vars.envVars.dataCollectorUrl+"/"+this.clientId,this.pixelUrl=this.vars.envVars.dataCollectorUrl),this.pageViewId=a.getUuidV4(),this.pixel=new d(this.pixelUrl,"pulse2",t.pixelThrottle),this.pixel.initPulsePixel(this.pageViewId,this.clientId),this.pulse2timing={pixelDone:Date.now()},t.transport?this.transport=t.transport:this.transport=new u,t.respectDoNotTrack===!0&&1===navigator.doNotTrack?this.allowTracking=!1:this.allowTracking=!0,this.opts=t,this.contentId=t.contentId||t.pageId||document.location,this.contentType=t.contentType||t.pageType||"Content",this.userIdDomain=t.userIdDomain,this.noRedirect=!0,this.utils=a,this.queue=new h(100),this.events=new s(this),this.user=new c({userId:this.opts.userId,userIdDomain:this.opts.userIdDomain,userServiceUrl:this.opts.userServiceUrl,noRedirect:this.noRedirect,transport:this.transport,utils:this.utils,waitForOptOut:this.waitForOptOut}),this.plugins=new p(this.opts),this.trigger=new l(this),this.initIds(function(){}),this.plugins.call(this.plugins.sdkLoad,this)}}var o=i(10)("spt:pulse"),r={},s=i(11),a=i(14),c=i(15),d=i(19),u=i(16),h=i(20),p=i(21),l=i(22),g="2.4.1";try{r=i(17)}catch(f){r=i(18)}n.prototype.initIds=function(t){var e=this;t=t||function(){},o("Fetching Ids"),this.pulse2timing.fetchIds=Date.now(),this.user.getUserId(function(i,n){e.idsDoneCallback(i,n,t),e.plugins.call(e.plugins.sdkReady,e)})},n.prototype.idsDoneCallback=function(t,e,i){return t?(o("Failed to fetch ids from CIS",t),delete this.envId):(this.userId||(this.userId=e.userId),this.envId=e.envId),this.pulse2timing.receivedIds=Date.now(),this.waitingToTransmitQueue===!0&&(this.sendQueue(),this.waitingToTransmitQueue=!1),this.doPixelSync(),i(e)},n.prototype.doPixelSync=function(){var t,e="https://secure.adnxs.com/getuid?https://cis.schibsted.com/api/v1/sync?ANID=$UID";this.user.shouldSyncWithAn&&(this.user.shouldSyncWithAn=!1,this.user.setAnIdUnresolved(),t=new d(e,"pulse2an",1),t.initPixel())},n.prototype.sendQueue=function(t){var e,i,n=this;if(t=t||function(){},!this.queue.count())return t("no items in queue");if(!this.allowTracking)return t("tracking not allowed");if(this.plugins.call(this.plugins.eventCreated,this.queue.peekAll()),"send"!==this.isUserInfoResolved()||"send"!==this.optOutAction())return this.waitingToTransmitQueue=!0,t("not ready to send");for(o("Sending queue"),i=this.queue.pullAll(),e=0;e<i.length;e++)this.enrichEvents(i[e]);this.plugins.call(this.plugins.eventReady,i),this.transport.post(this.url,i,function(e){e?(o("Failed to send queue"),n.queue.pushMany(i),t(e)):(n.plugins.call(n.plugins.eventSent,i),t(null,!0))})},n.prototype.send=function(t,e){var i=this;return e||(e=function(){}),this.allowTracking?(this.plugins.call(this.plugins.eventCreated,t),"send"!==this.isUserInfoResolved()||"send"!==this.optOutAction()?(this.queue.push(t),this.waitingToTransmitQueue=!0,e("not ready to send")):(o("Sending object"),this.enrichEvents(t),this.plugins.call(this.plugins.eventReady,t),void this.transport.post(this.url,[t],function(n){n?(o("Failed to send object"),i.queue.push(t),e(n)):(i.plugins.call(i.plugins.eventSent,t),e(null,!0))}))):e("tracking not allowed")},n.prototype.optOutAction=function(){return this.waitForOptOut&&"wait"===this.optOut?"wait":this.waitForOptOut&&this.optOut?"discard":"send"},n.prototype.setOptOut=function(t,e){return this.optOut=t,this.waitingToTransmitQueue===!0&&(this.waitingToTransmitQueue=!1),this.sendQueue(e)},n.prototype.isUserInfoResolved=function(){return"undefined"==typeof this.envId?"SDK: Waiting for envId":this.envId.indexOf("undefined")>-1?(delete this.envId,"SDK: Waiting for envId"):this.user.doTracking===!1?"CIS: user has opted out":"send"},n.prototype.enrichEvents=function(t){this.addTheIds(t),t.tracker.performance&&(t.tracker.performance.pulse2.sendEvents=Date.now())},n.prototype.addTheIds=function(t){var e=this.user.getTheEnvironmentId(),i=this.user.getTheUserId(),n=this.user.getTheJweIds();t.actor&&e&&"undefined"!==e&&(0!==String(e).indexOf("urn:")?(t.actor["@id"]="urn:schibsted.com:environment:"+e,t.actor["spt:environmentId"]="urn:schibsted.com:environment:"+e):(t.actor["@id"]=e,t.actor["spt:environmentId"]=e),n&&(t.device.jweIds=n),t.actor["spt:userId"]=i)},n.prototype.getPageViewId=function(){return this.pageViewId},n.prototype.getSessionId=function(){this.opts.debugMode&&console.log("activity.js: Deprecated: getSessionId")},n.prototype.userLogout=function(){delete this.user.idObj.userId,this.refreshUserIds()},n.prototype.userLogin=function(t){this.user.idObj.userId=t,this.refreshUserIds()},n.prototype.refreshUserIds=function(){this.waitingToTransmitQueue=!0,this.initIds()},t.exports=n},function(t,e){"use strict";t.exports=function(){return function(){}}},function(t,e,i){"use strict";function n(t){if(!t)throw new Error("activity required");this.activity=t,this.opts=t.opts,this.contentId=t.contentId,this.contentType=t.contentType}var o=i(12),r=i(13);n.prototype.trackContentView=function(t){var e=new r(this.activity);return e.type="View",e.object=this.addPageStandards(e.object),e.object.name=t||document.title,e.object.displayName=e.object.name,e.object.properties={},e.object.properties=this.reMapCustom(e.object.properties,"@type"),e.object.properties=this.reMapCustom(e.object.properties,"action"),e.object.properties=this.reMapCustom(e.object.properties,"item"),this.opts.filters&&(e.object.filters=this.opts.filters),document.referrer&&(e.origin={url:document.referrer}),this.opts.contentType&&("classifiedad"===this.opts.contentType.toLowerCase()&&(e.schema.schema="http://schema.schibsted.com/events/ad-view-event.json/27.json#"),"listing"===this.opts.contentType.toLowerCase()&&(e.schema.schema="http://schema.schibsted.com/events/search-result-list-view.json/31.json#")),new o(e,["object","origin"])},n.prototype.trackBasic=function(t,e,i,n){var s=new r(this.activity);return e=e||"Content",i=i||"undefined",s.id=this.getUrnIdWithContentType(i,e),s.type=t||"View","object"==typeof n?s.addCustomDataToProperty(s.object,n):s.activity.opts.debugMode&&console.log("events.js:trackBasic: objectMeta must be an object"),s.object["@id"]=this.getUrnIdWithContentType(i,e),s.object["@type"]=e,s.origin=this.addPageStandards(s.origin),new o(s,["object","origin"])},n.prototype.trackCreate=function(t,e,i){return this.trackBasic("Create",t,e,i)},n.prototype.trackUpdate=function(t,e,i){return this.trackBasic("Update",t,e,i)},n.prototype.trackReply=function(t,e,i){var n=new r(this.activity);return t=t||"Content",e=e||this.opts.contentId,n.id=this.getUrnIdWithContentType(e,t),n.type="Send",n.addCustomDataToProperty(n.object,i),n.object["@type"]=t,n.origin=this.addPageStandards(n.origin),new o(n,["object","origin"])},n.prototype.trackLogin=function(t,e,i){return this.trackBasic("Login",t,e,i)},n.prototype.trackLogout=function(t,e,i){return this.trackBasic("Logout",t,e,i)},n.prototype.trackClick=function(t,e,i,n,s){var a=new r(this.activity);return a.type=s||"Accept",a.object["@id"]=this.getUrnIdWithContentType(n,i)+":element:"+t,a.object["@type"]="Link",a.object.name=e,a.object.displayName=e,a.schema.target={"@id":this.getUrnIdWithContentType(n,i),"@type":i},new o(a,["object","target"])},n.prototype.trackSocial=function(t,e,i){var n=new r(this.activity);return n.type=i||"Like",n.origin=this.addPageStandards(n.origin),n.object["@id"]=this.getUrnIdWithContentType()+":element:"+t,n.object["@type"]="Link",n.schema.target={"@id":"urn:"+e.toLowerCase()+":action:"+n.type.toLowerCase(),"@type":"Service"},new o(n,["object","origin","target"])},n.prototype.trackMediaState=function(t,e,i){var n=new r(this.activity);return n.type=i||"Watch",n.object={"@type":e,"@id":this.getUrnIdWithContentType()+":"+e+":"+t},n.origin=this.addPageStandards(n.origin),new o(n,["object","origin"])},n.prototype.trackScroll=function(t,e){var i=new r(this.activity);return i.type=e||"Arrive",i.object=this.addPageStandards(i.object),i.schema.result={"@type":"Place","@id":this.getUrnIdWithContentType()+":scroll:"+t,"spt:depth":t},new o(i,["object","result"])},n.prototype.trackVisibility=function(t,e,i){var n=new r(this.activity);if("undefined"==typeof e)throw new Error("No time parameter was passed to this function");return n.type=i||"View",n.origin=this.addPageStandards(n.origin),n.object={"@type":"Content","@id":this.getUrnIdWithContentType()+":element:"+t},e.start?n.object.startTime=e.start:e&&!e.end&&(n.object.startTime=e),e.end&&(n.object.endTime=e.end),new o(n,["origin","object"])},n.prototype.trackExit=function(t,e,i){var n=new r(this.activity);return n.type=i||"Leave",n.object=this.addPageStandards(n.object),n.schema.target={},"undefined"!=typeof t&&"undefined"!=typeof e&&(n.schema.target={"@type":e,"@id":this.getUrnIdWithContentType(t,e)}),new o(n,["object","target"])},n.prototype.trackEngagement=function(t,e,i,n,s,a,c){var d,u=new r(this.activity);if(u.schema.schema="http://schema.schibsted.com/events/engagement-event.json/16.json#",u.type="Engagement",u.origin=this.addPageStandards(u.origin),c){if(d=c,"string"==typeof c)try{d=JSON.parse(c)}catch(h){u.activity.opts.debugMode&&console.log("Error parsing JSON: "+h)}"object"==typeof d&&u.addCustomDataToProperty(u.object,d)}return n&&s?(u.object["@id"]=u.origin["@id"]+":"+n+":"+s,u.object["@type"]=n,u.object.action=a):u.object=this.addPageStandards(u.object),t||0===t?u.schema.duration=t:u.schema.duration=this.activity.utils.getViewDuration(),e||0===e?u.schema.scrollPosition=e:u.schema.scrollPosition=this.activity.utils.getScrollPosition(),u.schema.action=i,new o(u,["object"])},n.prototype.trackEngagementTime=function(t,e,i){return this.trackEngagement(t,i)},n.prototype.trackCustomEvent=function(t,e,i){var n=new r(this.activity);return n.type=e||"Custom",n.object=this.addPageStandards(n.object),"object"==typeof i&&n.addCustomDataToProperty(n.object["spt:custom"],i),t&&(n.provider.eventIdentifier=t),new o(n,["object"])},n.prototype.trackCustom=function(t,e){var i=new r(this.activity);return i.type=t&&!~t.indexOf("custom:")?"custom:".concat(t):t||"custom:Content",i.object=this.addPageStandards(i.object),i.schema.schema="http://schema.schibsted.com/events/custom-event.json/0.json#","object"==typeof e&&(i.custom=e),new o(i,["object"])},n.prototype.addPageStandards=function(t){return t=t||{},t["@type"]=this.activity.contentType,String(this.activity.contentId).indexOf("urn:")>-1?t["@id"]=this.activity.contentId:t["@id"]=this.getUrnIdWithContentType(this.activity.contentId),t.url=document.URL,t.name=document.title,t.displayName=document.title,this.opts.inLanguage&&(t.inLanguage=this.opts.inLanguage),this.opts.tags&&Array.isArray(this.opts.tags)&&(t.tags=this.opts.tags),this.validateAndSet(t,"adType",this.opts.adType,"string"),this.validateAndSet(t,"location",this.opts.contentLocation,"object"),this.validateAndSet(t,"publisher",this.opts.publisher,"object"),this.validateAndSet(t,"publisherType",this.opts.publisherType,"object"),this.validateAndSet(t,"images",this.opts.images,"object"),this.validateAndSet(t,"published",this.opts.published,"string"),this.validateAndSet(t,"price",this.opts.price),this.validateAndSet(t,"currency",this.opts.currency,"string"),this.validateAndSet(t,"items",this.opts.items,"object"),this.addCategoryToEvents(t)},n.prototype.validateAndSet=function(t,e,i,n){return e&&i?n&&typeof i!==n?(console.log("not valid"+e+" : "+n),void(this.activity.opts.debugMode&&console.log(e+" is not of type "+n))):void(t[e]=i):void 0},n.prototype.addCategoryToEvents=function(t){var e=this.activity.opts,i="";return e.provider=e.provider||{},e.object=e.object||{},e.category?i=e.category:e.object.category?i=e.object.category:e.provider.category&&(i=e.provider.category),Array.isArray(i)&&(i=i.toString()),i&&(t.category=i),t},n.prototype.getUrnIdWithContentType=function(t,e){var i,n,o=t||this.activity.contentId;return-1===String(o).indexOf("urn:")?(i=e||this.activity.contentType,n=this.getDomainFromUrl(document.URL),"urn:"+n+":"+i.toLowerCase()+":"+o):o},n.prototype.getDomainFromUrl=function(t){var e=t.match(/^https?\:\/\/(www.)?([^\/:?#]+)(?:[\/:?#]|$)/i);return e&&e[2]},n.prototype.reMapCustom=function(t,e,i){return i!==!1&&(i=!0),this.opts.object&&this.opts.object.properties&&this.opts.object.properties[e]?(t[e]=this.opts.object.properties[e],i&&delete this.opts.object.properties[e],t):t},t.exports=n},function(t,e){"use strict";function i(t,e){if(!t)throw new Error("data required");try{this.data=t.getSchema()}catch(i){throw new Error("get schema function required")}if(!t.activity)throw new Error("data must have property activity");this.activity=t.activity,this.objectOrder=e||[]}i.prototype.queue=function(){this.activity.queue.push(this.data)},i.prototype.send=function(t){this.activity.send(this.data,t)},i.prototype.addProperty=function(t,e,i){var n=this.getObjectKey(t);return this.data[n][e]=i,this},i.prototype.addCustomData=function(t,e){var i=this.getObjectKey(t);return this.data[i]["spt:custom"]=e,this},i.prototype.getObjectKey=function(t){if("primary"===t)return this.objectOrder[0];if("secondary"===t)return this.objectOrder[1];if("tertiary"===t)return this.objectOrder[2];throw new Error("Object reference not valid")},t.exports=i},function(t,e,i){"use strict";function n(t,e){if(!t)throw new Error("Activity needed");this.activity=t,this.reducedEvent=e,this.schema={},this.type=null,this.actor={},this.device={},this.provider={},this.object={},this.origin={},this.location={},this.tracker={},this.initSchema()}var o=i(14);n.prototype.initSchema=function(){this.schema["@id"]=o.getUuidV4(),this.schema["spt:pageViewId"]=this.activity.pageViewId,this.schema.published=o.getTimestamp(),this.schema.schema="http://schema.schibsted.com/events/base-event.schema.json/25.json",this.createActor(),this.createTracker(),this.createDevice(),this.createProvider(),this.createObject(),this.createOrigin(),this.createLocation(),this.addCustomData()},n.prototype.populateSchema=function(){this.schema["@type"]=this.type,this.schema.actor=this.actor,this.schema.tracker=this.tracker,this.schema.device=this.device,this.schema.provider=this.provider,this.schema.object=this.object,this.schema.origin=this.origin,this.schema.location=this.location,this.target&&(this.schema.target=this.target),this.result&&(this.schema.result=this.result),this.scrollPosition&&(this.schema.scrollPosition=this.scrollPosition),this.duration&&(this.schema.duration=this.duration),this.custom&&(this.schema.custom=this.custom)},n.prototype.createDevice=function(){this.device.deviceType=o.getDeviceType(navigator.userAgent)},n.prototype.createObject=function(){this.object["spt:custom"]={}},n.prototype.createOrigin=function(){},n.prototype.createTracker=function(){this.tracker.version=this.activity.version,this.tracker.type="JS",this.reducedEvent||this.extendedTrackerData()},n.prototype.extendedTrackerData=function(){this.tracker.performance={},this.tracker.performance.pulse2=this.activity.pulse2timing,this.tracker.name="Pulse v2 tracker JS SDK",window.performance&&(this.tracker.performance.browser={},this.tracker.performance.browser=window.performance.timing)},n.prototype.createLocation=function(){this.activity.opts&&this.activity.opts.location&&(this.location["@type"]="Place",this.location.latitude=this.activity.opts.location.latitude,this.location.longitude=this.activity.opts.location.longitude,this.location.accuracy=this.activity.opts.location.accuracy)},n.prototype.createActor=function(){this.actor["@type"]="Person",this.reducedEvent||this.extendedActorData()},n.prototype.extendedActorData=function(){this.actor["spt:userAgent"]=navigator.userAgent,this.actor["spt:screenSize"]=window.screen.width+"x"+window.screen.height,this.actor["spt:viewportSize"]=o.getViewportDimensions(),this.actor["spt:acceptLanguage"]=o.getDeviceLanguage()},n.prototype.createProvider=function(){this.provider["@type"]="Organization",this.provider["@id"]=this.activity.clientId,this.provider.url=document.URL},n.prototype.addCustomData=function(){this.activity.opts&&(this.addCustomDataToProperty(this.provider,this.activity.opts.provider),this.addCustomDataToProperty(this.object["spt:custom"],this.activity.opts.object))},n.prototype.addCustomDataToProperty=function(t,e){var i;for(i in e)t.hasOwnProperty(i)||(t[i]=e[i])},n.prototype.getSchema=function(){return this.populateSchema(),this.schema},n.prototype.getString=function(){return JSON.stringify(this.getSchema())},t.exports=n},function(t,e){"use strict";t.exports.retry=function(t,e,i){var n,o=1;if(!t||"number"!=typeof t)throw new Error("times required");if(!e||"function"!=typeof e)throw new Error("task required");if(!i||"function"!=typeof i)throw new Error("callback required");n=function(){arguments[0]&&o>=t?i.apply(null,arguments):arguments[0]?(o+=1,e(n)):i.apply(null,arguments)},e(n)},t.exports.getViewportDimensions=function(){var t,e;return"undefined"!=typeof window.innerWidth?(t=window.innerWidth,e=window.innerHeight):"undefined"!=typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(t=document.documentElement.clientWidth,e=document.documentElement.clientHeight):(t=document.getElementsByTagName("body")[0].clientWidth,e=document.getElementsByTagName("body")[0].clientHeight),t+"x"+e},t.exports.getDeviceLanguage=function(){var t;return navigator.userLanguage?t=navigator.userLanguage:navigator.language&&(t=navigator.language),t},t.exports.getDeviceType=function(t){var e={mobile:["iPhone;","iPod;","iPod touch;","^HTC","Fennec","IEMobile","BB10;","BlackBerry","SymbianOS.*AppleWebKit","^Mozilla.*Mobile.*Firefox","^Mozilla.*Chrome.*Mobile","Opera Mobi","Android.*Mobile","Android.*Mini","Symbian","^SonyEricsson","^Nokia","^SAMSUNG","^LG"],tablet:["iPad;","Android"]},i=function(e){var i,n=0;for(n;n<e.length;n++)if(i=e[n],t.match(new RegExp(i)))return!0;return!1};if(t){if(i(e.mobile))return"mobile";if(i(e.tablet))return"tablet"}return"desktop"},t.exports.getTimestamp=function(){var t=new Date,e=-t.getTimezoneOffset(),i=e>=0?"+":"-",n=function(t){var e=Math.abs(Math.floor(t));return(10>e?"0":"")+e},o=t.getFullYear()+"-"+n(t.getMonth()+1)+"-"+n(t.getDate());return o=o+"T"+n(t.getHours())+":"+n(t.getMinutes()),o=o+":"+n(t.getSeconds()),o=o+i+n(e/60)+":"+n(e%60)},t.exports.getUuidV4=function(){var t,e,i="";for(e=0;36>e;e++)t=14===e?4:19===e?Math.floor(4*Math.random()+8).toString(16):8===e||13===e||18===e||23===e?"-":Math.floor(16*Math.random()).toString(16),i+=t;return i},t.exports.getUrlParams=function(t){var e,i,n=[],o=location.search,r=o.split("&"),s=new RegExp(t+"=([^&;]+?)(&|#|;|$)","i");for(i=0;i<r.length;i++)e=r[i].match(s),e&&n.push(e[1]);return n},t.exports.getQueryVariable=function(t){var e,i,n,o=window.location.search.substring(1),r=o.split("&");for(e=0;e<r.length;e++)if(i=r[e].split("="),i[0]===t)return i[1];for(r=o.split("&amp"),e=0;e<r.length;e++)if(n=r[e].split("="),n[0]===t)return n[1]},t.exports.getScrollPosition=function(){return(window.pageYOffset||document.scrollTop)-(document.clientTop||0)},t.exports.getViewDuration=function(){var t,e,i;if(!window.performance)return null;t=window.performance.timing.domLoading,e=Date.now();try{i=e-t}catch(n){i=null}return i}},function(t,e,i){"use strict";function n(t){t=t||{},this.idObj={},this.cookieKey="_pulse2data",this.cookiesAllowed=navigator.cookieEnabled,this.anonIdPlaceholder="x",this.opts=t,this.userIdDomain=t.userIdDomain||"schibsted.com",this.userId=this.opts.userId,this.userId||(delete this.userId,delete this.opts.userId),this.visitorIdPlaceholder="v",this.redirectString="https://cis.schibsted.com/redirect/?redirectUrl="+document.location,this.userServiceUrl=t.userServiceUrl||s.envVars.userServiceUrl,this.transport=t.transport||new o,this.utils=r,this.noRedirect=!0,this.doValidation=!1,this.shouldSyncWithAn=!1,this.shouldFetchFromAn=!1,this.hasCookie=!1,this.anSyncUrl="https://secure.adnxs.com/getuidj",this.doTracking=!0,this.anSyncStatus="nothing has happened","undefined"!=typeof t.noRedirect&&(this.noRedirect=t.noRedirect)}var o=i(16),r=i(14),s={};try{s=i(17)}catch(a){s=i(18)}n.prototype.getUserId=function(t){var e,i=this;return t=t||function(){},e=this.getIdsFromCookie(),this.userId&&(e.userId=this.createUserIdWithUrn(this.userId)),this.mapUserData(e),!this.idObj.envId||this.userStatusHasChanged()||this.doValidation?(this.doValidation=!1,this.getIdsFromService(this.idObj,function(e,n){return i.onIdServiceResponse(e,n,t)}),void this.doAppNexusSync(null,function(){return t(null,i.idObj)})):(setTimeout(function(){i.doAppNexusSync()},2e3),t(null,this.idObj))},n.prototype.mapUserData=function(t){var e,i,n=["undefined","false","0","","null"];this.idObj.userId=t.userId||this.idObj.userId,this.idObj.envId=t.environmentId||t.envId,this.idObj.prevUserId=t.prevUserId,this.idObj.anId=t.anId||this.idObj.anId,this.idObj.jweIds=t.jwe||this.idObj.jweIds,this.idObj.pixelInjected=t.pixelInjected||null,t.doAnSync&&(this.shouldSyncWithAn=t.doAnSync),this.doTracking=this.resolveDoTracking(t.doTracking),this.idObj.userId&&(e=this.idObj.userId.split(":"),i=e[e.length-1],n.indexOf(i)>=0&&delete this.idObj.userId),this.setIdsInCookie()},n.prototype.setIdsInCookie=function(){var t,e,i=this.idObj.userId||this.anonIdPlaceholder,n=new Date,o=new Date,r=new Date,s=n.getTime();this.idObj.envId&&(n.setTime(s+9e5),o.setTime(s+144e5),r.setTime(s+63072e6),t=[this.idObj.envId,this.visitorIdPlaceholder,i,n.getTime(),this.idObj.jweIds,this.idObj.anId,o.getTime(),this.doTracking.toString(),this.idObj.pixelInjected],e=this.cookieKey+"="+t,e+=";domain="+document.domain,e+=";path=/",e+=";expires="+r.toUTCString(),document.cookie=e)},n.prototype.getIdsFromCookie=function(){var t,e,i=this.getCookie(this.cookieKey);return i&&-1===i.indexOf("undefined")?(t=i.split(","),t.length<2?(this.deleteCookie(this.cookieKey),{}):(t[3]&&Date.now()>parseInt(t[3],10)&&(this.doValidation=!0,this.hasCookie=!0),t[6]&&Date.now()>parseInt(t[6],10)&&(this.shouldSyncWithAn=!0,this.doValidation=!1),t[5]&&"unresolved"!==t[8]||(t[8]="unresolved",this.shouldFetchFromAn=!0),e={environmentId:t[0],prevUserId:t[2],jwe:t[4],anId:t[5],doTracking:t[7],pixelInjected:t[8]})):(this.deleteCookie(this.cookieKey),this.shouldSyncWithAn=!0,{})},n.prototype.getCookie=function(t){var e=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||!1;return e},n.prototype.deleteCookie=function(t){document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT"},n.prototype.getIdsFromService=function(t,e){var i=this.userServiceUrl,n=3,o={environmentId:t.envId,userId:t.userId,jwe:t.jweIds};t.anId&&(o.anId=t.anId),this.opts.waitForOptOut&&(o.waitForOptOut=this.opts.waitForOptOut),this.hasCookie&&(n=1),this.transport.post(i,o,function(t,i){var n;t&&e(t),n=JSON.parse(i.response||i.responseText),n.data.anid&&"0"!==n.data.anid||(n.data.doAnSync=!0),this.mapUserData(n.data),e(null,n.data)}.bind(this),!0,n)},n.prototype.onIdServiceResponse=function(t,e,i){return this.hasCookie?(this.hasCookie=!1,i(null,this.idObj)):(t&&i(t),i(null,this.idObj))},n.prototype.userStatusHasChanged=function(){var t=this.idObj.userId,e=this.idObj.prevUserId;return e?t&&e!==t.toString()||!t&&e!==this.anonIdPlaceholder:!1},n.prototype.doAppNexusSync=function(t,e){var i=this;return e=e||function(){},this.shouldFetchFromAn?(this.shouldFetchFromAn=!1,void this.transport.get(this.anSyncUrl,null,function(t,n){var o;return t?e(t,n):(o=JSON.parse(n.response||n.responseText),i.idObj.anId=o.uid,i.mapUserData(i.idObj),i.setAnIdResolved(),i.getIdsFromService(i.idObj,function(t,n){return i.onIdServiceResponse(t,n,e)}),e())},1,!0)):t},n.prototype.setAnIdUnresolved=function(){this.idObj.pixelInjected="unresolved",this.setIdsInCookie(this.idObj)},n.prototype.setAnIdResolved=function(){this.idObj.pixelInjected=null,this.setIdsInCookie(this.idObj)},n.prototype.getTheUserId=function(){return this.createUserIdWithUrn(this.idObj.userId)},n.prototype.getTheEnvironmentId=function(){return this.idObj.envId},n.prototype.getTheJweIds=function(){return this.idObj.jweIds},n.prototype.createUserIdWithUrn=function(t,e){return!t||String(t).indexOf("undefined")>-1?e:String(t).indexOf("urn:")>-1?t:"urn:"+this.userIdDomain+":user:"+t},n.prototype.resolveDoTracking=function(t){return t===!0||"true"===t||1===t?!0:t===!1||"false"===t||0===t?!1:this.doTracking},t.exports=n},function(t,e,i){"use strict";function n(){this.utils=o}var o=i(14);n.prototype.getUrlWithCorrectProtocol=function(t){var e=t.split("://");return"//"+e.pop()},n.prototype.getXHR=function(t,e,i){var n;return"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e.toLowerCase(),this.getUrlWithCorrectProtocol(i)),
n):(n=new XMLHttpRequest,"withCredentials"in n?(n.open(e,i),n.setRequestHeader("Content-Type","application/json; charset=utf-8"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),t&&(n.withCredentials=!0),n):!1)},n.prototype.addDataToUrl=function(t,e){var i,n;if(!e||"object"!=typeof e)return t;for(i=Object.keys(e);i&&"object"==typeof e[i[0]];)i.shift();for(t=this.appendParameterToUrl(t,i[0],e[i[0]],"?"),n=1;n<i.length;n++)t=this.appendParameterToUrl(t,i[n],e[i[n]],"&");return t},n.prototype.appendParameterToUrl=function(t,e,i,n){return"object"!=typeof i?t+n+encodeURIComponent(e)+"="+encodeURIComponent(i):t},n.prototype.post=function(t,e,i,n,o){return t?e&&"object"==typeof e?(n=n||!1,void this.send(t,e,i,n,o,"POST")):i("data required"):i("url required")},n.prototype.get=function(t,e,i,n,o){return t?(e&&(t=this.addDataToUrl(t,e)),void this.send(t,e,i,o,n,"GET")):i("url required")},n.prototype.send=function(t,e,i,n,o,r){var s=this;if(!i)throw new Error("callback required");o=o||3,this.utils.retry(o,function(i){var o=s.getXHR(n,r,t);if(o||i("Failed to identify request method"),"undefined"!=typeof XDomainRequest?(o.onload=function(){i(null,o)},o.onprogress=function(){},o.onerror=function(){i("Failed request"),o.abort()},o.ontimeout=o.onerror):o.onreadystatechange=function(){4===o.readyState&&(200===o.status?i(null,o):i("Failed with status "+o.status))},"POST"===r)try{o.send(JSON.stringify(e))}catch(a){i(a.name+": "+a.message)}else if("GET"===r)try{o.send()}catch(a){i(a)}},i)},t.exports=n},function(t,e){"use strict";t.exports.envVars={dataCollectorUrl:"https://collector.schibsted.io/api/v1/track",userServiceUrl:"https://cis.schibsted.com/api/v1/identify",errorReportingUrl:""}},function(t,e){"use strict";t.exports.envVars={dataCollectorUrl:"http://127.0.0.1:8002/api/v1/track",userServiceUrl:"https://cis.schibsted.com/api/v1/identify",errorReportingUrl:""}},function(t,e){"use strict";function i(t,e,i){this.collectorBaseUrl=t,this.service=e||"pulse2",this.clientId="",this.pageViewId="",this.throttle=.1,i>=0&&(this.throttle=i)}i.prototype.initPulsePixel=function(t,e){this.clientId=e,this.pageViewId=t,this.collectorBaseUrl=this.getImageTrackingUrl(this.collectorBaseUrl),this.createPulsePixelUrl(),this.initPixel()},i.prototype.initPixel=function(){Math.random()<this.throttle&&this.collectorBaseUrl&&this.injectPixel()},i.prototype.createPulsePixelUrl=function(){var t="?provider.@id="+this.clientId;t+="&service="+this.service,t+="&@type=Pixel",t+="&@id="+this.pageViewId,this.collectorBaseUrl+=t},i.prototype.injectPixel=function(){var t=this.createImgElement(),e=document.getElementsByTagName("body");e.item(0).appendChild(t)},i.prototype.getImageTrackingUrl=function(t){var e="",i=/\/api\/v[0-9]\/track$/;try{e=t.replace(i,"/img")}catch(n){return}return t!==e&&e?e:void 0},i.prototype.createImgElement=function(){var t=document.createElement("img");return t.src=this.collectorBaseUrl,t.id=this.service+"pixel",t.style.visibility="hidden",t},t.exports=i},function(t,e){"use strict";function i(t){if(!t)throw new Error("size of the queue must be given");this.maxSize=t,this.queue=[]}i.prototype.push=function(t){this.queue.push(t),this.queue.length>this.maxSize&&this.queue.shift()},i.prototype.pushMany=function(t){if(!Array.isArray(t))throw new Error("elements must be an array");this.queue=this.queue.concat(t),this.queue.length>this.maxSize&&(this.queue=this.queue.slice(this.queue.length-this.maxSize,this.queue.length))},i.prototype.pull=function(){return this.queue.shift()},i.prototype.pullAll=function(){return this.queue.splice(0,this.queue.length)},i.prototype.peek=function(){return this.queue[0]},i.prototype.peekAll=function(){return this.queue},i.prototype.count=function(){return this.queue.length},t.exports=i},function(t,e){"use strict";function i(t){this.opts=t,this.plugins=window.pulse2plugins||[],this.hooks={eventCreated:this.plugins.eventCreatedHooks||[],eventReady:this.plugins.eventReadyHooks||[],eventSent:this.plugins.eventSentHooks||[],load:this.plugins.onLoadHooks||[],ready:this.plugins.onReadyHooks||[]},this.sdkReady="ready",this.sdkLoad="load",this.eventCreated="eventCreated",this.eventReady="eventReady",this.eventSent="eventSent"}i.prototype.call=function(t,e){switch(t){case this.eventCreated:case this.eventReady:case this.eventSent:return this.callEventHooks(e,this.hooks[t]);case this.sdkReady:case this.sdkLoad:return this.callSdkHooks(e,this.hooks[t]);default:return}},i.prototype.callEventHooksArray=function(t,e){var i,n=[];for(i=0;i<t.length;i++)n.push(this.callEventHooks(t[i],e));return n},i.prototype.callEventHooks=function(t,e){var i,n,o,r;if(e=e||[],Array.isArray(t))return this.callEventHooksArray(t,e);if(!t["@type"])return t;for(r=0;r<e.length;r++)if(i=e[r],n=Object.keys(i)[0].toLowerCase(),"all"===n||n===t["@type"].toLowerCase())try{o=i[n](t),o&&(t=o)}catch(s){this.opts.debugMode&&console.log("plugins.js: A pulse2 sdk plugin failed: "+s)}return t},i.prototype.callSdkHooks=function(t,e){var i;if("object"==typeof e&&"object"==typeof t)for(i=0;i<e.length;i++)try{e[i](t)}catch(n){this.opts.debugMode&&console.log("plugins.js: A pulse2 event plugin failed: "+n)}},i.prototype.on=function(t,e,i){var n={};t&&e&&(i?n[i]=e:n=e,this.hooks[t].push(n))},t.exports=i},function(t,e){"use strict";function i(t){this.activity=t,this.plugins=this.activity.plugins,this.registerTriggers()}i.prototype.registerTriggers=function(){this.plugins.on(this.plugins.sdkLoad,this.getUrlTriggers)},i.prototype.getUrlTriggers=function(t){var e,i,n,o,r,s,a=t.utils.getUrlParams("p2param");for(i=0;i<a.length;i++){for(s={},o=a[i].split("."),n=o.slice(2),r=0;r<n.length;r++)try{n[r]=n[r].split("_"),s[n[r][0]]=n[r][1]}catch(c){this.activity.opts.debugMode&&console.log("trigger.js: An error occurred while reading URL param: "+c)}e=t.events.trackCustomEvent(null,o[0],s),e.data.object.displayName=o[1],e.data.object["@id"]+=":elementId:"+o[1],e.send()}},t.exports=i}])});var pulse2config = {
    "client": "leboncoin",
    "config": [
        {
            "throttle": 1,
            "dataCollector": "https://collector.schibsted.io/api/v1/track",
            "cis": "https://cis.schibsted.com/api/v1/identify"
        }
    ]
}
;